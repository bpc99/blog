---
title: Linux top
date: 2021-01-27 15:23:10
subtitle: linux-top
tags:
  - Linux
categories: [Linux]
---

电脑运行时，如果需要查询正在运行的程序和内存占用情况，以及找出那个程序导致我们电脑卡顿，这些都是`top`命令可以胜任的工作，它能有效的监听电脑进程的运行情况，并提供`PID`字段可以让用户处理占用 cpu 消耗较大的应用。

<!-- more -->

首先我的服务器系统为**Centos7.8**，如果不一样那么打印出的信息可能会有些差别：
```
> top
```
执行完毕后，界面打印出下面信息：
```
top - 00:59:04 up 21:49,  2 users,  load average: 0.09, 0.25, 0.34
Tasks: 102 total,   1 running, 101 sleeping,   0 stopped,   0 zombie
%Cpu(s):  7.4 us,  4.4 sy,  0.0 ni, 88.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :  1014696 total,   131908 free,   366040 used,   516748 buff/cache
KiB Swap:  1049596 total,   777980 free,   271616 used.   499336 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND 
```
可能第一次看着比较乱，但是这些信息将电脑的cpu、内存等资源的使用情况都提供出来了。

## 如何阅读
首先其输出分作两部分，**上部分**(1 - 5行)为一些统计的信息，其余则是**下部分**包含所有服务信息的一个表格(由于太多没有列出来，只是列出一个表头)。

而我们解析只需要从这两部分入手。
### 上部分
**第一行：**主要用于显示当前事件、服务器登陆数、系统负载情况。
- `top`：监测时的系统时间(会一直刷新)。
- `users`：系统登陆数。
- `load average`：三个值，分别为过去1分钟、5分钟、15分钟的系统负载。

**第二行：**主要用于显示系统中各个类型进程的个数。
- `total`：系统总进程数。
- `running`：系统运行进程数。
- `sleeping`：系统等待的进程数。
- `stopped`：系统停止的进程数。
- `zombie`：系统被复原的进程数。

**第三行：**该行主要显示按类型划分 cpu 使用情况。
- `us`：用户进程占比。
- `sy`：系统进程占比。
- `ni`：nice 用户进程占比，也就是改变过优先级类型的进程占比。
- `id`：cpu 空闲时间占比，该值越小说明 cpu 越忙。
- `wa`：等待异步操作完成的时间占比。
- `hi`：硬中断占用 cpu 的百分比。
- `si`：软中断占用 cpu 的百分比。
- `st`："虚拟机管理程序从该虚拟机窃取的时间占比"。

可以使用 **t**(toggle) 切换折叠 **Task**(第二行) 和 **%Cpu(s)**(第三行) 的展开和折叠。

**第四行与第五行：**主要提供了内存、交换分区的信息。
- `total`：总内存容量。
- `free`：空闲内存。
- `used`：已用内存。

### 下部分
系统中正在运行的进程，默认按照 cpu 使用频率降序排序，我们输入`M`进行按照内存排序，输入`P`按照 cpu 使用频率排序。当然如果 cpu 使用频率较高的话，表示程序消耗了许多的资源，也就是造成电脑卡顿的最终祸首。
其提供了下面关于服务的信息：
- `PID`：进程的唯一标识符，可以借助 ID 关闭指定的服务。
- `USER`：运行进程的用户。
- `PR`：优先级。
- `NI`：Nice 值，表示进程的优先级。
- `VIRT`：虚拟内存的大小。
-  `RES`：常驻内存的大小。
-  `SHR`：共享内存的大小。
-  `S`：进程的运行状态，**I** 代表空闲、**R** 代表运行、**S** 代表休眠、**Z**表示僵尸进程、**T** 或 **t** 代表停止等。
-  `%CPU`：自上次屏幕更新 cpu 的使用率。
-  `%MEM`：自上次屏幕更新，**RES**常用内存使用率。
-  `TIME+`：自从程序启动后总的 CPU 使用时间。
-  `COMMAND`：启动命令。

## cpu使用率较高
当 cpu 空闲时间较高时，服务器可以正常的工作，当 cpu 空闲较低时，我们的服务器会变得非常的卡，甚至会影像到我们部署到服务器上的各个服务。
例如我服务器为阿里云最基础的配置，如果同时在服务器下载多个文件，那么便会出现：

![cpu 空闲较小](https://img.bipch.cn/2021/02/03/fadf5610c2839.png)

这种情况，可以看到`id`已经为0，此时服务器会非常的卡，甚至我们部署在服务器上的服务也都是无法进行访问的，此时需要在 top 命令行中输入`k`，此时程序会给出提示：
```
PID to signal/kill [default pid = 30] 
```
其默认关闭排行第一的服务，也可以自己输入指定程序的`PID`字段，回车便可以关闭指定的程序，关闭成功后，服务器恢复正常：

![cpu 恢复](https://img.bipch.cn/2021/02/03/aa81b31b64157.png)

我们可以借助 top 命令查询当前系统的运行状态，其也为我们提供了很多配置帮助我们更好的进行工作，查找指定指定配置我们可以看其为我们提供的[手册](https://man7.org/linux/man-pages/man1/top.1.html)。