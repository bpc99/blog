---
title: 垃圾回收机制
subtitle: javascript-garbage-collection
date: 2020-11-20 12:20:36
tags:
  - JavaScript
categories: [web]
---
在 JavaScript 中所有的内存管理是自动执行的，并且都是不可见的。我们创建的基本类型、对象、函数等，这些都是需要分配内存的，但是由于其是不可见的，所以我们要明白怎么进行空间的分配、不用的时候，会发生什么呢？JS 引擎如何清理它呢？

<!-- more -->
## 可达性
JavaScript 中内存管理的重要概念便是`可达性`，其主要负责我们项目能够访问到的值，都能够保存到内存中。其主要有下面几个要点：

- **有一组基本的固有可达值，由于显而易见的原因无法删除，这些值称为`根`**。
	例如：
	- 本地函数的局部变量和参数。
	- 当前嵌套调用链上的其它函数的变量和参数。
	- 全局变量。
	- 还有一些其它的，内部的。
- **如果引用可以从根访问任何其它值，则认为该值是可以访问的**。
	例如：在代码中定义一个对象，并且在别的地方对该对象进行引用，则该对象视为具有`可达性`，它引用的值也是可以访问的，而 JS 引擎中有一个后台进程称为**垃圾回收器**，它监视所有代码中的对象，并删除那些**不具有**可达性的对象。
## 案例
虽然叙述起来可能很绕嘴，但是其含义还是很容易理解的，例如下面代码：
```javascript
let user = {
  name: 'jack'
};
```
代码定义了一个对象`{name: 'jack'}`并定义 **user** 指针指向该对象，此时对象`{name: 'jack'}`被访问不会被清除，但是我们添加下面代码：
```diff
let user = {
  name: 'jack'
};
+ user = null;
```
这样对象`{name: 'jack'}`就被覆盖掉了，其不具备`可达性`，所以此时垃圾回收器便会将其视为垃圾进行回收，释放内存。
## 垃圾回收
JavaScript 的垃圾回收机制有很多种，下面简单列举几种：
### 标记-清除
一种很常见的垃圾回收算法，它主要定期执行下面的步骤：

1. 垃圾回收器获取根并 **”标记“** 它们。
2. 然后它访问并 **"标记"** 所有来自它们的引用。
3. 然后它访问标记对象的引用。所有被访问对象都会被记住，以便以后不再访问同一对象两次。
4. 以此类推，直到引用都标记完成(从根节点开始访问)。
5. 除了标记对象外，所有对象都被删除。